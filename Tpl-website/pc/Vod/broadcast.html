<head>
    <meta charset="UTF-8">
    <title>录播</title>
    <meta name="keywords" content="{$seoData.keywords}">
    <meta name="description" content="{$seoData.description}">
     <link rel="stylesheet" href="__CSS__/student/student.css">
    <script src="__JS__/lib/jquery-3.1.1.min.js"></script>
    <script src='__JS__/lib/require.js'></script>
    <script src="__JS__/lib/main.js"></script>
    <script type="text/javascript" src="__PLUGINS__/ckplayer/barrage.js" charset="utf-8"></script>
    <script type="text/javascript" src="__PLUGINS__/ckplayer/ckplayer.js" charset="utf-8"></script>
    <if condition="$playurl eq ''">
        <script>
            function setCookie(name,value,iTime){
                var oDate = new Date();
                //设置cookie过期时间
                oDate.setDate(oDate.getDate()+iTime);
                document.cookie = name+'='+value+';expires='+oDate.toGMTString();
            }
            //获取cookie
            function getCookie(name){
                //cookie中的数据都是以分号加空格区分开
                var arr = document.cookie.split("; ");
                for(var i=0; i<arr.length; i++){
                    if(arr[i].split("=")[0] == name){
                        return arr[i].split("=")[1];
                    }
                }
                //未找到对应的cookie则返回空字符串
                return '';
            }
            //删除cookie
            function removeCookie(name){
                //调用setCookie方法，把时间设置为-1
                setCookie(name,1,-1);
            }
            var lesson_id = "{$lesson_info['vod_id']}";
            var num = getCookie(lesson_id);
            if(!num){
                setCookie(lesson_id,1,5);
                location.href=location.href
            }else if(num > 1){
                removeCookie(lesson_id);
                location.href = "{:U('/Index/index')}";
            }else{
                setCookie(lesson_id,parseInt(num)+ 1,5);
                location.href=location.href
            }

        </script>
    </if>
</head>


<body>
    <div class="broadcast-wapper">
        <button class="close-window-btn"><a href="{:U('/Vod/videodetail',array('tnid'=>$id))}">退出</a></button>
        <div class="broadcast-right">
            <div class="course-title">
                <h3>【{$detailInfo.fid_label}.{$detailInfo.cat_id_label}】</h3>
                <span>{$lesson_info.zc_title}</span>
                <div class="online-people-count">
                </div>
            </div>
            <div class="player-wapper">
                <div class="player-content" id="player-content">
                    <script type="text/javascript">
                        var flashvars={
                            f:'<php>echo $playurl</php>',
                            c:0,
                            b:0,
                            fs:1,
                            loaded:'loadedHandler'
                        };
                        var video=['<php>echo $playurl</php>'];
                        var params={bgcolor:'#FFF',allowFullScreen:true,allowScriptAccess:'always',wmode:'transparent',allowFullScreenInteractive:true};
                        CKobject.embed('__PLUGINS__/ckplayer/ckplayer.swf','player-content','ckplayer_a1','100%','100%',false,flashvars,video,params)
                    </script>
                </div>
            </div>
        </div>
        <div class="broadcast-left">
        <div class="shrink"></div>
            <div class="slider-top">
                <img class="teacher-photo" src="{$teacherInfo.zc_headimg}" alt="">
                <div class="teacher-info">
                    <span>主讲人:</span>
                    <span style="padding-left: 5px; ">{$teacherInfo.zc_nickname}</span>
                    <p style="margin-top:5px;font-size:12px;color: #a1a1a1;">{$teacherInfo.zc_school}</p>
                    <eq name="teacherInfo.is_auth" value="1"><i>认证教师</i></eq>
                </div>
            </div>
            <div class="forum-box">
                <div class="forum-title">
                    <i class="icon"></i>
                    <span>讨论区</span>
                </div>
                <div class="chat-bxo" >
                </div>
                <div class="send-sms">
                    <input class="sms-content" type="text" placeholder="请输入内容">
                    <button class="send-sms-btn vod-send-msg" lesson_id="{$lesson_info.vod_id}">发送</button>
                </div>
            </div>
        </div>
    </div>
</body>

<script>
    require(["studentBrodcast"], function(studentBrodcast) {
        studentBrodcast()
    })
    $(function(){
        talk();
        setTimeout('vodSum()',10000);
    })
    var lesson_id = {$lesson_info.vod_id};
    function vodSum(){
        $.ajax({
            type: "POST",
            url: "{:U('/Vod/vodSum')}",
            data: "lesson_id="+lesson_id,
            success: function(msg){
                setTimeout('vodSum()',10000);
            }
        });
    }


    function talk(){
        var url = "{:U('/Vod/talk')}";
//        alert(url);
        var talk =
                $.post(url,{
                    "lesson_id" : lesson_id,
                },function(data){
                    $('.chat-bxo').empty();
                    $('.chat-bxo').append(data);
                    setTimeout('talk()',9000);
                },'json')
    }
</script>
